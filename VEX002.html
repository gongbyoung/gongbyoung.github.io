<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Houdini VEX 지식 탐색기</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f7f9fc; color: #333; }
        .container { max-width: 900px; margin: auto; background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        h1 { color: #3498db; border-bottom: 3px solid #3498db; padding-bottom: 10px; margin-bottom: 20px; }
        input[type="text"] { width: 100%; padding: 12px; margin-bottom: 20px; border: 2px solid #ccc; border-radius: 6px; font-size: 16px; box-sizing: border-box; transition: border-color 0.3s; }
        input[type="text"]:focus { border-color: #2980b9; outline: none; }
        .result-section { margin-top: 30px; }
        .section-title { font-size: 1.4em; color: #2c3e50; border-bottom: 1px solid #ddd; padding-bottom: 5px; margin-bottom: 15px; font-weight: bold; }
        .item { padding: 10px; border-left: 5px solid #bdc3c7; margin-bottom: 10px; background-color: #ecf0f1; border-radius: 4px; }
        .item strong { display: block; margin-bottom: 5px; }
        .attribute-name { color: #27ae60; font-family: Consolas, monospace; font-weight: bold; }
        .function-name { color: #e74c3c; font-family: Consolas, monospace; font-weight: bold; }
        .learning-topic { color: #9b59b6; }
        .loading { text-align: center; color: #7f8c8d; }
    </style>
</head>
<body>

<div class="container">
    <h1>Houdini VEX 지식 탐색기</h1>
    <p>VEX는 VOP 노드 방식보다 10배 이상 빠릅니다 [223].</p>
    <input type="text" id="searchInput" placeholder="VEX 함수, 속성, 타입 또는 학습 주제를 검색하세요 (예: @P, set, if, quaternion)">

    <div id="loadingStatus" class="loading">VEX 지식 데이터베이스 로드 중...</div>

    <div class="result-section" id="functionResults">
        <div class="section-title">VEX 함수 및 속성</div>
    </div>

    <div class="result-section" id="learningResults">
        <div class="section-title">Joy of VEX 학습 주제</div>
    </div>
</div>

<script>
    let vexData = null;
    const searchInput = document.getElementById('searchInput');
    const funcOutput = document.getElementById('functionResults');
    const learnOutput = document.getElementById('learningResults');
    const loadingStatus = document.getElementById('loadingStatus');

    // 1. JSON 데이터 로드
    async function loadVEXData() {
        try {
            // vex_functions.json 파일 로드
            const funcRes = await fetch('vex_functions.json');
            
            if (!funcRes.ok) throw new Error("JSON file not found or failed to load");

            const data = await funcRes.json();
            vexData = {
                attributes: data.attributes,
                functions: data.functions,
                learningTopics: data.learning_topics
            };

            loadingStatus.style.display = 'none';
            searchInput.addEventListener('input', handleSearch);
            handleSearch(); // 초기 전체 목록 표시
        } catch (e) {
            loadingStatus.innerHTML = `<p style="color:red;">데이터 로드 실패: ${e.message}. 'vex_functions.json' 파일을 확인해 주세요.</p>`;
            console.error(e);
        }
    }

    // 2. 검색 처리 로직
    function handleSearch() {
        if (!vexData) return;

        const query = searchInput.value.toLowerCase().trim();
        // 검색어를 공백 기준으로 분리 (다중 키워드 검색 지원)
        const keywords = query.split(/\s+/).filter(k => k.length > 1);

        // 검색 필터링 함수
        const filterItems = (items) => {
            if (query === "") return items; 
            
            return items.filter(item => {
                const searchString = JSON.stringify(item).toLowerCase();
                return keywords.every(kw => searchString.includes(kw));
            });
        };

        // --- 함수 및 속성 검색 (통합) ---
        const combinedFunctions = [
            ...vexData.attributes.map(a => ({...a, category: '속성', className: 'attribute-name'})),
            ...vexData.functions.map(f => ({...f, category: '함수', className: 'function-name'}))
        ];

        const filteredFunctions = filterItems(combinedFunctions);
        let funcHtml = '<div class="section-title">VEX 함수 및 속성</div>';
        
        if (filteredFunctions.length > 0) {
            filteredFunctions.forEach(item => {
                funcHtml += `
                    <div class="item">
                        <span class="${item.className}">${item.name}</span> (${item.type}) 
                        <br><strong>[${item.category}]</strong> ${item.description}
                    </div>
                `;
            });
        } else {
            funcHtml += `<p>일치하는 VEX 함수/속성을 찾을 수 없습니다.</p>`;
        }
        funcOutput.innerHTML = funcHtml;

        // --- 학습 주제 검색 ---
        const filteredLearning = filterItems(vexData.learningTopics);
        let learnHtml = '<div class="section-title">Joy of VEX 학습 주제</div>';

        if (filteredLearning.length > 0) {
            filteredLearning.forEach(item => {
                learnHtml += `
                    <div class="item">
                        <span class="learning-topic">Day ${item.day}:</span> ${item.topic} 
                        <br><strong>(핵심 개념: ${item.concept})</strong>
                    </div>
                `;
            });
        } else {
            learnHtml += `<p>일치하는 학습 주제를 찾을 수 없습니다.</p>`;
        }
        learnOutput.innerHTML = learnHtml;
    }

    // 초기 데이터 로드 시작
    loadVEXData();
</script>

</body>
</html>
