<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>꽃말 주크박스</title>
  <style>
    body {
      background-image: url('img/bg1.jpeg'); /* 원하는 배경 사용 */
      background-size: cover;
      color: white;
      font-family: sans-serif;
      text-align: center;
      padding-top: 50px;
    }
    #nowPlaying {
      font-size: 24px;
      margin: 20px;
    }
    audio {
      margin-top: 20px;
      width: 300px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/jsmediatags@3.9.5/dist/jsmediatags.min.js"></script>
</head>
<body>

  <h1>🎵 꽃말 랜덤 주크박스</h1>
  <div id="nowPlaying">재생 준비 중...</div>
  <audio id="audio" controls autoplay></audio>

  <script>
    let files = [];
    let currentIndex = -1;

    function fetchFileList() {
      fetch('files.json')
        .then(res => res.json())
        .then(data => {
          files = data;
          if (files.length === 0) {
            document.getElementById('nowPlaying').textContent = '❌ 재생할 파일이 없습니다.';
            return;
          }
          playNext(); // 첫 곡 재생
        })
        .catch(err => {
          console.error(err);
          document.getElementById('nowPlaying').textContent = '⚠️ 파일 목록을 불러올 수 없습니다.';
        });
    }

    function playNext() {
      if (files.length === 0) return;

      currentIndex = (currentIndex + 1) % files.length;
      const fileName = files[currentIndex];
      const filePath = `mp3/${fileName}`;
      const audio = document.getElementById('audio');
      audio.src = filePath;
      audio.play();

      // 제목 초기 텍스트
      document.getElementById('nowPlaying').textContent = `🎵 ${fileName}`;

      // ID3 태그로 제목 읽기
      jsmediatags.read(filePath, {
        onSuccess: function(tag) {
          const title = tag.tags.title || fileName;
          document.getElementById('nowPlaying').textContent = `🎵 ${title}`;
        },
        onError: function(error) {
          console.warn("메타데이터 오류:", error);
        }
      });
    }

    // 다음 곡 자동 재생
    document.getElementById('audio').addEventListener('ended', playNext);

    // 시작
    fetchFileList();
  </script>

</body>
</html>
