<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê½ƒë§ ì£¼í¬ë°•ìŠ¤</title>
  <style>
    body {
      background-image: url('img/bg1.jpeg'); /* ì›í•˜ëŠ” ë°°ê²½ ì‚¬ìš© */
      background-size: cover;
      color: white;
      font-family: sans-serif;
      text-align: center;
      padding-top: 50px;
    }
    #nowPlaying {
      font-size: 24px;
      margin: 20px;
    }
    audio {
      margin-top: 20px;
      width: 300px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/jsmediatags@3.9.5/dist/jsmediatags.min.js"></script>
</head>
<body>

  <h1>ğŸµ ê½ƒë§ ëœë¤ ì£¼í¬ë°•ìŠ¤</h1>
  <div id="nowPlaying">ì¬ìƒ ì¤€ë¹„ ì¤‘...</div>
  <audio id="audio" controls autoplay></audio>

  <script>
    let files = [];
    let currentIndex = -1;

    function fetchFileList() {
      fetch('files.json')
        .then(res => res.json())
        .then(data => {
          files = data;
          if (files.length === 0) {
            document.getElementById('nowPlaying').textContent = 'âŒ ì¬ìƒí•  íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.';
            return;
          }
          playNext(); // ì²« ê³¡ ì¬ìƒ
        })
        .catch(err => {
          console.error(err);
          document.getElementById('nowPlaying').textContent = 'âš ï¸ íŒŒì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
        });
    }

    function playNext() {
      if (files.length === 0) return;

      currentIndex = (currentIndex + 1) % files.length;
      const fileName = files[currentIndex];
      const filePath = `mp3/${fileName}`;
      const audio = document.getElementById('audio');
      audio.src = filePath;
      audio.play();

      // ì œëª© ì´ˆê¸° í…ìŠ¤íŠ¸
      document.getElementById('nowPlaying').textContent = `ğŸµ ${fileName}`;

      // ID3 íƒœê·¸ë¡œ ì œëª© ì½ê¸°
      jsmediatags.read(filePath, {
        onSuccess: function(tag) {
          const title = tag.tags.title || fileName;
          document.getElementById('nowPlaying').textContent = `ğŸµ ${title}`;
        },
        onError: function(error) {
          console.warn("ë©”íƒ€ë°ì´í„° ì˜¤ë¥˜:", error);
        }
      });
    }

    // ë‹¤ìŒ ê³¡ ìë™ ì¬ìƒ
    document.getElementById('audio').addEventListener('ended', playNext);

    // ì‹œì‘
    fetchFileList();
  </script>

</body>
</html>
